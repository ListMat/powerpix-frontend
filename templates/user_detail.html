{% extends "base.html" %}

{% block title %}Detalhes do Usuário - PowerPix Admin{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold">Detalhes do Usuário</h1>
        <a href="/admin/users" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
            <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
            Voltar
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Informações do Usuário -->
        <div class="lg:col-span-1 space-y-6">
            <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
                <h3 class="text-lg font-semibold mb-4">Informações Pessoais</h3>
                <form method="post" action="/admin/users/{{ usuario.id }}/edit" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                        <input type="text" name="nome" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.nome or '' }}" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                        <input type="text" name="cpf" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.cpf or '' }}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                        <input type="text" name="telefone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.telefone or '' }}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Chave PIX</label>
                        <input type="text" name="pix" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.pix or '' }}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
                        <input type="text" name="cidade" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.cidade or '' }}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                        <input type="text" name="estado" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="{{ usuario.estado or '' }}">
                    </div>
                    <button type="submit" class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors inline-flex items-center justify-center gap-2">
                        <i data-lucide="save" style="width: 18px; height: 18px;"></i>
                        Salvar Alterações
                    </button>
                </form>
            </div>

            <!-- Adicionar Saldo -->
            <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
                <h3 class="text-lg font-semibold mb-4">Adicionar Saldo</h3>
                <p class="mb-4">
                    <strong>Saldo Atual:</strong> 
                    <span class="ml-2 px-3 py-1 inline-flex text-sm font-semibold rounded-full bg-green-100 text-green-800">
                        {{ usuario.saldo | currency }}
                    </span>
                </p>
                <form method="post" action="/admin/users/{{ usuario.id }}/add-balance" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Valor</label>
                        <input type="number" name="valor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" step="0.01" min="0.01" required placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                        <input type="text" name="descricao" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" value="Saldo adicionado pelo administrador">
                    </div>
                    <button type="submit" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors inline-flex items-center justify-center gap-2">
                        <i data-lucide="plus-circle" style="width: 18px; height: 18px;"></i>
                        Adicionar Saldo
                    </button>
                </form>
            </div>

            <!-- Ações -->
            <div class="rounded-xl border border-red-200 bg-red-50 p-6 shadow-sm">
                <h3 class="text-lg font-semibold mb-4 text-red-900">Ações</h3>
                {% if usuario.is_archived %}
                <form method="post" action="/admin/users/{{ usuario.id }}/reactivate" class="mb-3">
                    <button type="submit" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors inline-flex items-center justify-center gap-2">
                        <i data-lucide="refresh-cw" style="width: 18px; height: 18px;"></i>
                        Reativar Conta
                    </button>
                </form>
                <p class="text-xs text-gray-600 mb-3">Conta arquivada em: {{ usuario.data_arquivamento.strftime('%d/%m/%Y %H:%M') if usuario.data_arquivamento else 'N/A' }}</p>
                {% else %}
                <form method="post" action="/admin/users/{{ usuario.id }}/delete" onsubmit="return confirm('Tem certeza que deseja arquivar este usuário? A conta será desativada mas poderá ser reativada depois.');">
                    <button type="submit" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors inline-flex items-center justify-center gap-2">
                        <i data-lucide="archive" style="width: 18px; height: 18px;"></i>
                        Arquivar Conta
                    </button>
                </form>
                {% endif %}
            </div>
        </div>

        <!-- Histórico -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Apostas -->
            <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold">Histórico de Apostas</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Números</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for aposta in apostas %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ aposta.id }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ aposta.data_aposta.strftime('%d/%m/%Y %H:%M') if aposta.data_aposta else 'N/A' }}</td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    {% set brancos = aposta.numeros_brancos | from_json %}
                                    {% set vermelhos = aposta.numeros_vermelhos | from_json %}
                                    <div class="text-xs">
                                        <div>Brancos: {{ brancos[:5] | join(', ') }}{% if brancos|length > 5 %}...{% endif %}</div>
                                        <div>Vermelhos: {{ vermelhos | join(', ') }}</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ aposta.valor_pago | currency }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if aposta.is_winner %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Ganhou</span>
                                    {% else %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Aguardando</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-gray-500">Nenhuma aposta encontrada</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transações -->
            <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold">Histórico de Transações</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for transacao in transacoes %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ transacao.id }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ transacao.data_transacao.strftime('%d/%m/%Y %H:%M') if transacao.data_transacao else 'N/A' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if transacao.tipo.value == 'DEPOSITO' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Depósito</span>
                                    {% elif transacao.tipo.value == 'APOSTA' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Aposta</span>
                                    {% elif transacao.tipo.value == 'PREMIO' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Prêmio</span>
                                    {% elif transacao.tipo.value == 'SAQUE' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Saque</span>
                                    {% else %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">{{ transacao.tipo.value }}</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    {% if transacao.tipo.value == 'DEPOSITO' or transacao.tipo.value == 'PREMIO' %}
                                        <span class="text-green-600">+{{ transacao.valor | currency }}</span>
                                    {% else %}
                                        <span class="text-red-600">-{{ transacao.valor | currency }}</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if transacao.status.value == 'PAGO' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Pago</span>
                                    {% elif transacao.status.value == 'PENDENTE' %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Pendente</span>
                                    {% else %}
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">{{ transacao.status.value }}</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    <span class="text-xs">{{ transacao.descricao or 'N/A' }}</span>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-500">Nenhuma transação encontrada</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
    lucide.createIcons();
</script>
{% endblock %}
